name: Release Etch WP Skill

on:
  push:
    tags:
      - 'v*.*.*'

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Get version from tag
      id: get_version
      run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

    - name: Update version in SKILL.md
      run: |
        VERSION=${{ steps.get_version.outputs.VERSION }}
        sed -i "s/version: [0-9]\+\.[0-9]\+\.[0-9]\+/version: $VERSION/" SKILL.md

    - name: Create release package
      run: |
        # Create temp directory
        mkdir -p temp_release

        # Copy files directly (no subfolder)
        cp SKILL.md temp_release/
        cp LICENSE temp_release/ 2>/dev/null || true
        cp README.md temp_release/ 2>/dev/null || true
        cp -r scripts temp_release/
        cp -r references temp_release/
        cp -r assets temp_release/ 2>/dev/null || true

        # Create zip with flat structure (SKILL.md on root level)
        cd temp_release
        zip -r ../etch-wp.zip .
        cd ..

        # Clean up
        rm -rf temp_release

    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        files: etch-wp.zip
        name: Etch WP Skill ${{ github.ref_name }}
        body: |
          ## Etch WP Skill ${{ github.ref_name }}

          ### Installation

          **Claude Desktop:**
          1. Download `etch-wp.zip` from this release
          2. Open Claude Desktop > Settings > Skills
          3. Click "Install from File"
          4. Select the downloaded `etch-wp.zip`

          **Claude Code CLI:**
          ```bash
          # Create skill directory and extract
          mkdir -p ~/.claude/skills/etch-wp
          unzip etch-wp.zip -d ~/.claude/skills/etch-wp/
          ```

          ### Contents
          - SKILL.md (main skill definition - root level)
          - references/ (documentation)
          - scripts/ (validation tools)
          - assets/ (templates)

          ### What's New
          See commit history for details.
        draft: false
        prerelease: false
